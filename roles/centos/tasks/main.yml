---
- name: Make sure that the ansible/files directory exists
  file: path=/home/ansible/files/ state=directory

- name: Packages
  yum: name={{ item }} state=latest
  with_items:
      - epel-release
      - lsof
      - telnet
      - tmux
      - vim
      - wget
      - libselinux-python
      - ntp
      - sudo
      - dstat

- name: upgrade operating system
  yum: name=* state=latest

- name: ansible user authorized_keys
  copy: src=ansible_authorized_keys dest=/home/ansible/.ssh/authorized_keys owner=ansible mode=0444

- name: Ensure ntpd is running and enabled
  service: name=ntpd state=started enabled=yes

- name: Max files
  sysctl: name=fs.file-max value=512000 state=present reload=yes
  ignore_errors: yes  

- name: Userlimit files
  lineinfile: dest=/etc/security/limits.conf line="* - nofile 64000" insertafter=EOF

- name: Setup sudoers
  copy: src=sudoers dest=/etc/sudoers owner=root group=root mode=0440 validate='visudo -cf %s'

- name: rsyslog configuration
  copy: src=rsyslog.conf dest=/etc/ owner=root group=root mode=0644 
  notify:
    - restart rsyslog

- name: ssh moduli file copy
  copy: src=moduli dest=/etc/ssh/moduli owner=root group=root mode=0444

